# 設計仕様書 - 材料データベース × 元素周期表 × デザインリサーチ統合

## 📋 プロジェクト設計方針（固定版）

### 更新日
2025年1月（STEP 1: 設計固定）

---

## 1. 想定ユーザー

### 1.1 主要ユーザー層

#### 層1: デザイナー・クリエイター（優先度：高）
- **特徴**:
  - 材料の視覚的・触覚的特性を重視
  - 入手可能性、コスト、加工方法が重要
  - デザインリサーチの文脈で材料を探索
- **利用シーン**:
  - 「この色合いの材料は何があるか」
  - 「手に入りやすい軽量材料は？」
  - 「この材料の歴史やストーリーを知りたい」
- **必要な機能**:
  - 材料カードの3タブ構造（物性、入手先・用途、歴史・物語）
  - 視覚的な材料探索
  - 元素周期表からの検索（「この元素を含む材料は？」）

#### 層2: 教育・研究用途（優先度：中）
- **特徴**:
  - 材料と元素の関係を理解したい
  - 元素周期表と材料のマッピングを視覚的に学びたい
  - データの正確性・出典が重要
- **利用シーン**:
  - 「アルミニウムは周期表のどこにあるか」
  - 「この材料はどの元素からできているか」
  - 「元素周期表から材料を探索する」
- **必要な機能**:
  - 118元素すべてのカード化
  - 元素周期表からの検索
  - 材料と元素の関連付け
  - データの出典明記

#### 層3: 一般ユーザー（優先度：低）
- **特徴**:
  - 材料について学びたい
  - 元素周期表に興味がある
- **利用シーン**:
  - 「この材料は何からできているか」
  - 「元素周期表を見てみたい」
- **必要な機能**:
  - わかりやすいUI
  - 基本的な検索機能

### 1.2 ユーザー層の優先順位
1. **デザイナー・クリエイター**（MVPの主要ターゲット）
2. **教育・研究用途**（将来拡張）
3. **一般ユーザー**（将来的に考慮）

---

## 2. MVP（最小実行可能製品）の定義

### 2.1 MVPで「必ずやること」

#### 必須機能（Phase 1-3）
1. **材料カードの3タブ構造**
   - タブ1: 材料物性（既存機能を維持）
   - タブ2: 入手先・用途（新規）
   - タブ3: 歴史・物語（新規）

2. **118元素すべてのカード化**
   - 元素記号、原子番号、原子量、周期、族、分類
   - 権利的に安全なデータ（Wikidata CC0、公的データ）
   - 元素カードの表示

3. **元素周期表からの検索機能**
   - 周期表を表示
   - 元素をクリックして選択
   - 選択した元素を含む材料を検索・表示

4. **基本的なデータ管理**
   - 材料データの登録・編集・削除（既存機能維持）
   - 元素データの表示（読み取り専用）

### 2.2 今回は「やらないこと」

#### 除外機能（Phase 4以降または将来実装）
1. **材料と元素の自動関連付け**
   - 材料に含まれる元素を自動で判定する機能
   - → 手動登録のみ（MVPでは）

2. **材料の元素周期表マッピング**
   - 材料が周期表のどこに位置づくかの自動可視化
   - → Phase 5で実装

3. **LLM統合**
   - 自然言語検索
   - AIによる材料推奨
   - → 将来実装

4. **高度な可視化**
   - 3D周期表
   - 複雑なグラフ・チャート
   - → 将来実装

5. **ユーザー認証・多ユーザー対応**
   - ログイン機能
   - ユーザーごとのデータ管理
   - → 将来実装

6. **API公開**
   - 外部API提供
   - → 将来実装

---

## 3. データの責務分離

### 3.1 元素データ（Element Data）

#### 責務
- **読み取り専用**（ユーザーが編集不可）
- 118元素の基本情報を提供
- 元素周期表の表示に使用
- 材料と元素の関連付けの基準

#### データソース
- **基本データ**: Wikidata（CC0 - パブリックドメイン相当）
- **数値データ（原子量など）**: IUPAC標準データ（公的データ）
- **出典の明記**: 各データに出典を記録

#### データ構造
```
Element (元素)
├── symbol (元素記号) - 例: "H", "He", "Li"
├── atomic_number (原子番号) - 例: 1, 2, 3
├── atomic_weight (原子量) - 例: 1.008
├── period (周期) - 例: 1, 2, 3
├── group (族) - 例: 1, 2, 18
├── category (分類) - 例: "非金属", "金属", "半金属"
├── source (出典) - 例: "Wikidata CC0", "IUPAC"
└── source_url (出典URL) - 例: "https://www.wikidata.org/..."
```

#### データ管理
- **モジュール**: `periodic_table.py`
- **データファイル**: `data/elements.json`（Git管理）
- **更新頻度**: 手動更新（元素データは変更が少ない）

### 3.2 材料データ（Material Data）

#### 責務
- **読み書き可能**（ユーザーが登録・編集可能）
- 材料の詳細情報を管理
- 材料と元素の関連付け（手動登録）
- 材料カードの生成に使用

#### データソース
- **ユーザー入力**: 材料登録フォームから入力
- **サンプルデータ**: JIS規格に準拠したベーシックな材料（著作権フリー）
- **出典の記録**: 材料登録時に出典を記録可能

#### データ構造（既存 + 拡張）
```
Material (材料)
├── 基本情報（既存）
│   ├── name_official (正式名称)
│   ├── category_main (カテゴリ)
│   └── ...
├── 物性データ（既存）
│   └── properties (物性)
├── 入手先・用途（新規 - Phase 1）
│   ├── procurement_info (入手先情報)
│   ├── use_cases (用途情報)
│   └── reference_urls (参照URL)
└── 歴史・物語（新規 - Phase 1）
    ├── history_story (歴史・物語)
    ├── development_background (開発背景)
    └── related_materials (関連材料)
```

#### データ管理
- **モジュール**: `database.py`（既存）
- **データベース**: SQLite（既存）
- **更新頻度**: リアルタイム（ユーザーが随時登録・編集）

### 3.3 材料と元素の関連付け（Material-Element Relationship）

#### 責務
- 材料に含まれる元素を記録
- 元素から材料を逆引き可能にする
- 周期表からの検索に使用

#### データ構造（Phase 4で実装）
```
MaterialElement (材料-元素関連)
├── material_id (材料ID) - Foreign Key
├── element_symbol (元素記号) - Foreign Key
└── percentage (含有率) - 任意
```

#### データ管理
- **モジュール**: `material_service.py`（新規）
- **データベース**: SQLite（新規テーブル）
- **更新頻度**: ユーザーが材料登録・編集時に手動で関連付け

---

## 4. 権利方針（Copyright & License Policy）

### 4.1 元素データの権利方針

#### 基本方針
- **Wikidata（CC0）を基本データソースとする**
  - CC0 = パブリックドメイン相当
  - 商用利用・改変・再配布すべて可能
  - 出典の明記は推奨（必須ではないが、透明性のため記載）

#### 数値データ（原子量など）
- **公的データのみを使用**
  - IUPAC（国際純正・応用化学連合）標準データ
  - NIST（米国標準技術研究所）データ
  - その他公的機関のデータ
- **出典の明記**: 必須

#### 禁止事項
- 商用の元素周期表データベースからの転載
- 著作権が不明確なデータの使用
- 出典不明の数値データの使用

### 4.2 画像の権利方針

#### 基本方針
- **原則すべて自前生成**
  - PIL（Pillow）を使用した画像生成
  - 元素カードの画像も自前生成
  - 材料カードの装飾画像も自前生成

#### 周期表の画像
- **周期表の"画像転載"は行わない**
  - 既存の周期表画像を使用しない
  - 周期表はコードで生成（HTML/CSS/Streamlit）
  - 元素カードもコードで生成

#### 材料画像
- **ユーザーアップロード**: ユーザーがアップロードした画像は、ユーザーの責任で使用
- **自動生成**: 画像がない場合は自動生成（PIL使用）
- **著作権フリー画像の使用**: 将来的に必要になった場合、明確に著作権フリーと明記された画像のみ使用

### 4.3 データの出典管理

#### 出典の記録方法
- **元素データ**: `data/elements.json` に `source` と `source_url` フィールドを追加
- **材料データ**: データベースに `source` フィールドを追加（任意）
- **UI表示**: 元素カードに「出典: Wikidata CC0」などを表示

#### 出典表示の例
```
元素: 水素 (H)
原子番号: 1
原子量: 1.008
出典: Wikidata CC0, IUPAC Standard Atomic Weights
出典URL: https://www.wikidata.org/wiki/Q556
```

---

## 5. アーキテクチャ設計

### 5.1 モジュール構成（責務分離）

```
app.py                    # UI層（Streamlit）
├── database.py           # データ層（SQLAlchemy）
│   ├── Material (材料)
│   ├── Property (物性)
│   ├── MaterialHistory (歴史・物語) - 新規
│   └── MaterialElement (材料-元素関連) - Phase 4
├── models.py             # データモデル（Pydantic）
├── periodic_table.py     # 元素周期表ロジック（新規）
│   ├── Element (元素データ)
│   ├── PeriodicTable (周期表表示)
│   └── ElementCard (元素カード生成)
├── material_service.py   # 材料ビジネスロジック（新規）
│   ├── MaterialService (材料操作)
│   └── MaterialElementService (材料-元素関連)
├── card_generator.py     # カード生成ロジック（既存・拡張）
│   ├── generate_material_card (材料カード)
│   └── generate_element_card (元素カード) - 新規
└── image_generator.py    # 画像生成ロジック（既存）
    └── generate_element_image (元素画像) - 新規
```

### 5.2 データフロー

```
ユーザー操作
  ↓
UI (app.py)
  ↓
ビジネスロジック
  ├── material_service.py (材料操作)
  ├── periodic_table.py (元素操作)
  └── card_generator.py (カード生成)
  ↓
データアクセス
  ├── database.py (SQLAlchemy - 材料データ)
  └── periodic_table.py (JSON読み込み - 元素データ)
  ↓
データストレージ
  ├── SQLite (材料データ)
  └── JSON (元素データ)
```

### 5.3 データの分離原則

1. **元素データ**: 読み取り専用、JSONファイル、Git管理
2. **材料データ**: 読み書き可能、SQLite、ユーザー管理
3. **関連付けデータ**: 読み書き可能、SQLite、ユーザー管理

---

## 6. 実装ルール（再確認）

### 6.1 各ステップの完了条件
- [ ] コードが動作する
- [ ] 既存機能が壊れていない
- [ ] エラーハンドリングが適切
- [ ] データの出典が明記されている
- [ ] 権利方針に準拠している

### 6.2 コミット方針
- 各ステップ完了時にコミット
- コミットメッセージに「Phase X, Step X.X」を明記
- 動作確認後にプッシュ

### 6.3 データソースの選定基準
- **必須**: パブリックドメインまたは明確なライセンス
- **必須**: 出典の明記
- **必須**: 商用利用可能
- **推奨**: 公的機関のデータ

---

## 7. 設計の固定事項（変更不可）

### 7.1 データソース
- **元素データ**: Wikidata（CC0）を基本
- **数値データ**: 公的データのみ
- **画像**: 原則すべて自前生成
- **周期表**: 画像転載は行わない（コードで生成）

### 7.2 ユーザー層の優先順位
1. デザイナー・クリエイター（MVPの主要ターゲット）
2. 教育・研究用途（将来拡張）
3. 一般ユーザー（将来的に考慮）

### 7.3 MVPの範囲
- **必ずやること**: Phase 1-3（材料カード3タブ、118元素カード化、周期表検索）
- **やらないこと**: Phase 4以降（材料-元素自動関連付け、マッピング、LLM統合など）

### 7.4 責務分離
- **元素データ**: 読み取り専用、JSON、Git管理
- **材料データ**: 読み書き可能、SQLite、ユーザー管理
- **関連付けデータ**: 読み書き可能、SQLite、ユーザー管理

---

## 8. 次のステップ

**STEP 2: Phase 1, Step 1.1 から開始**
- MaterialHistoryテーブルの追加（データベース拡張）
- 既存機能を壊さない安全な実装

---

## 📚 参考資料

- Wikidata: https://www.wikidata.org/
- IUPAC Periodic Table: https://iupac.org/what-we-do/periodic-table-of-elements/
- CC0 License: https://creativecommons.org/publicdomain/zero/1.0/



